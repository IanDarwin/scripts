#!/bin/sh

set -e

cd /mnt/dcim/1* || exit

# make sure names have reasonable case, regardless of some cameras' affection for screaming caps.
lcname -c *[A-Z]* | sh

echo 'jpg pictures\nmpg movies' | while read exten dir
do
echo Checking for $exten and moving to $dir

# Check if there are ANY $exten files in the camera
GO=no
for f in *.$exten; do if [ -f $f ]; then GO=yes; break; fi; done

case ${GO} in
yes)

DEST_DIR=$HOME/${dir}/`date +%Y%m%d`
if [ ! -d ${DEST_DIR} ]; then
	mkdir ${DEST_DIR}
fi
echo Using ${DEST_DIR}

cp -p *.${exten} ${DEST_DIR}/

chown -R ian:wheel ${DEST_DIR}
;;
esac

done	# end of while read loop

echo -n "Erase [no,yes] " 
read oktoerase
case ${oktoerase} in
	y*)	rm -f *.jpg *.JPG *.mpg *.MPG
		;;
	*)	echo LEAVING PIX ON CAMERA
		;;
esac
