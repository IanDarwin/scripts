#!/bin/sh

# umldot -- create a dot (graph) file from Java

FINAL_PP="dot -Tps $* | ps2pdf - > ${HOME}/umldot.pdf && start ${HOME}/umldot.pdf"
FINAL_PP="dot -Tsvg >${HOME}/umldot.svg && start ${HOME}/umldot.svg"
#FINAL_PP=cat

egrep -h '^public (class|interface)' *.java |
	tr -d , |
	awk '
	BEGIN {
			print "// Generated by Ian Darwin (www.darwinsys.com) umldot implementation"
			print "digraph java {"
			print "size=\"7,7;\""
		}
		{
			for (i=5; i<=NF; i++) {
				if ($i == "{")
					break;
				if ($i == "implements" || $i == "extends")
					continue;
				print "\"" $i "\" -> \"" $3 "\""
			}
		}
	END { print "}" }
	' | 
		eval ${FINAL_PP} 
