#!/bin/sh -f

# Export javasrc for distro with JavaCook web site.

# List of files is set in darian:/cvs/CVSROOT/modules line for javacook-src

set -x

cd /tmp

for dir in javacook javasrc
do
	if [ -d ${dir} ]; then
		mv ${dir} ${dir}-$$
		rm -rf ${dir}-$$ &
	fi
done

set -e
cvs -q -d ${CVSROOT-/cvs} export -D now javacook-src >/tmp/export$$

mv javasrc javacook

# Next section done in the subdirectory
(
	cd javacook

	# Update the index.html for just what we exported
	(cd netweb; jikes +E -d .. MkIndex.java)
	java MkIndex

)
# No longer in subdirectory

rm -f javacooksrc.zip
jar cf javacooksrc.zip ./javacook

exit 

scp javacooksrc.zip darwinsys.com:/www/javacook/ &&
	echo "JavaCook src updated at javacook.darwinsys.com/download.html" |
		Mail -s "java cookbook download updated" -v "Mary Hubben <maryh@oreilly.com>" ian webmaster@oreilly.com

# Now extract the whole mess so people can browse individually
# Note that this extracts in javacook/javacook, which is a bit confusing.
ssh darwinsys.com "cd /www/javacook; unzip -fo javacooksrc.zip"
